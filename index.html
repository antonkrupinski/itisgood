<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rammerhead Proxy</title>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" 
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" 
      crossorigin="anonymous">
<style>
  body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 20px; background: #1e1e2f; color: white; }
  header { text-align: center; margin-bottom: 30px; }
  header h1 { font-weight: bold; }
  #proxy-frame { width: 100%; height: 80vh; border: 2px solid #444; border-radius: 12px; background: black; }
  .card { background: #2a2a40; padding: 20px; border-radius: 12px; margin-bottom: 20px; }
  .btn-primary { background: #4e79ff; border: none; }
  .btn-primary:hover { background: #3e65d6; }
</style>
</head>
<body>

<header>
  <h1>Rammerhead Proxy</h1>
  <p>Each session is isolated, like an incognito browser.</p>
</header>

<div class="card">
  <div class="form-group">
    <label for="session-url">Enter URL</label>
    <div class="input-group">
      <input type="text" class="form-control" id="session-url" placeholder="https://www.example.com">
      <div class="input-group-append">
        <button class="btn btn-primary" id="session-go">Go!</button>
      </div>
    </div>
  </div>

  <div class="form-group">
    <label for="session-id">Session ID</label>
    <input type="text" readonly class="form-control" id="session-id" placeholder="Your session ID will appear here">
    <button class="btn btn-secondary mt-2" id="session-create-btn">Create New Session ID</button>
  </div>
</div>

<iframe id="proxy-frame" src=""></iframe>

<script>
let sessionId = null;

// Function to create a new session ID
async function createSession() {
  const res = await fetch('/.netlify/functions/proxy?url=');
  const data = await res.json();
  sessionId = data.session;
  document.getElementById('session-id').value = sessionId;
}

// Initialize session on page load
createSession();

document.getElementById('session-create-btn').addEventListener('click', () => {
  createSession();
});

// Go button
document.getElementById('session-go').addEventListener('click', () => {
  const url = document.getElementById('session-url').value.trim();
  if (!url) return alert('Enter a URL!');
  if (!sessionId) return alert('Session not ready. Try again in a second.');
  document.getElementById('proxy-frame').src = `/.netlify/functions/proxy?url=${encodeURIComponent(url)}&session=${sessionId}`;
});
</script>

</body>
</html>
